//=========================================================
// src/Interrupts.c: generated by Hardware Configurator
//
// This file will be regenerated when saving a document.
// leave the sections inside the "$[...]" comment tags alone
// or they will be overwritten!
//=========================================================

// USER INCLUDES			
#include <SI_EFM8BB1_Register_Enums.h>

//-----------------------------------------------------------------------------
// Global Constants
//-----------------------------------------------------------------------------
// Overflow rates of timer0 and timer1 are set to 1ms in Simplicity Configurator
#define LED_TOGGLE_RATE      100 // LED toggle rate in milliseconds
                                       // if LED_TOGGLE_RATE = 1, LED will
                                       // be on for 1 millisecond and off for
                                       // 1 millisecond
#define P1_5_TOGGLE_RATE        30 // P1_5 toggle rate in milliseconds
                                       // if P1_5_TOGGLE_RATE = 1, P1_5 will
                                       // be on for 1 millisecond and off for
                                       // 1 millisecond

//-----------------------------------------------------------------------------
// Pin Definitions
//-----------------------------------------------------------------------------
SI_SBIT (LED, SFR_P1, 4);        // P1.4 LED
SI_SBIT (P1_5, SFR_P1, 5);         // P1.5

//-----------------------------------------------------------------------------
// TIMER2_ISR
//-----------------------------------------------------------------------------
//
// TIMER2 ISR Content goes here. Remember to clear flag bits:
// TMR2CN::TF2H (Timer # High Byte Overflow Flag)
// TMR2CN::TF2L (Timer # Low Byte Overflow Flag)
//
// This function processes the Timer2 interrupt. It checks both counters for
// matches and, upon a match, toggles the LEDs.
//
//-----------------------------------------------------------------------------
SI_INTERRUPT(TIMER2_ISR, TIMER2_IRQn)
{
   static uint16_t low_counter = 0;
   static uint16_t high_counter = 0;

   if (TMR2CN0_TF2L == 1)
   {
	  low_counter++;

	  if (low_counter == LED_TOGGLE_RATE)
	  {
		 LED = !LED;       // Toggle LED

		 low_counter = 0;              // Reset interrupt counter
	  }

	  TMR2CN0_TF2L = 0;
   }
   if (TMR2CN0_TF2H == 1)
   {
	  high_counter++;

	  if (high_counter == P1_5_TOGGLE_RATE)
	  {
		 P1_5 = !P1_5;         // Toggle P1.5

		 high_counter = 0;             // Reset interrupt counter
	  }

	  TMR2CN0_TF2H = 0;
   }
}


